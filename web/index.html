<html lang="en">
  <script>

    var Module = {
        onRuntimeInitialized: function() {
            console.log('essentiamin.js and .wasm files are loaded sucessfully ...');
            loadSoundFromUri(sampleFreesoundUri);
        }
    };

  </script> 
  <link rel="shortcut icon" href="src/img/essentia_logo.ico">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Edit your site info here -->
    <meta name="essentiamin.js" content="WASM demo for essentiamin">

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css"/>
    <link rel="stylesheet" type="text/css" href="src/css/main.css"/>

    <title>wasm-demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/zeu"></script>
    <script src="https://unpkg.com/wavesurfer.js"></script>
    <script src="dist/essentiamin.js"></script>
    <script src="src/js/wavesurfer.microphone.min.js"></script>
    <script src="src/js/essentiatools.js"></script>
    <script src="src/js/utils.js"></script>
    <script src="src/js/dataviz.js"></script>
    <script>

      // 20 mb file upload limit
      FILE_UPLOAD_LIMIT = 20;
      var wavesurfer;
      var chartJsCtx;

      $(document).ready(function () {

            wavesurfer = WaveSurfer.create({
                container: '#waveform',
                waveColor: 'violet',
                progressColor: 'red',
                audioContext: audioContext,
                plugins: [
                    WaveSurfer.microphone.create({
                        'buffersize': 256
                    })
                ]
            });

            $('.menu .item').tab();

            $('#recordButton').click(function () {
                recordAudioWaveSurf();
            });
            $('#file-menu').change(function () {
                uploadAudioFileFromMenu($("#file-menu"), 'popup');
            });
            $('#file-uploader').on(
                'dragover',
                function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            )
            $('#file-uploader').on(
                'dragenter',
                function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
            )
            $('#file-uploader').on(
                'drop',
                function (e) {
                    if (e.originalEvent.dataTransfer) {
                        if (e.originalEvent.dataTransfer.files.length) {
                            e.preventDefault();
                            e.stopPropagation();
                            /*UPLOAD FILES HERE*/
                            uploadAudioFileFromMenu(e.originalEvent.dataTransfer.files[0], 'dragndrop');
                        }
                    }
                }
            );
        });
    </script> 
  </head>
  <body>  

    <div class="ui main_wrapper landing-image">

    <div class="ui header">
        <div class="ui eight column grid">
            <div class="eight wide centered column" style="margin-bottom: 60px;">
                <center><h1 class="ui huge header white-text">essentia.js demos </h1></center>
            </div>

        </div>
    </div>

    <br>

    <div class="body-container">

        <div class="ui two column grid container content-container">

            <div id="control_btns" class="control_btns six wide left aligned column">

                <div class="ui basic centered grid">
                    <div class="ui vertical buttons row">
                        <button id="recordButton" class="ui vertical red inverted big button record-button">Record
                            &nbsp;&nbsp;<i class="microphone icon"></i></button>
                    </div>
                </div>

                <div class="ui horizontal divider" style="color: papayawhip;">OR</div>

                <div class="ui basic segment row">
                    <div class="ui-widget" id="file-uploader">
                        <p style="position:absolute; padding: 12px; width:85%;"><br><br>Drag a file or click to select a file from your computer</p>
                        <input type="file" id="file-menu"/>
                    </div>
                </div>
                <div class="ui left basic row segment">
                    <p hidden id="status_demo" class="white-text"><span id="update_status"></span></p>
                </div>
            </div>
            <div id="results" class="ui ten wide column basic segment result-segment">
                <div class="ui row" style="margin-bottom: 40px;">
                    <center>
                        <div id="waveform"></div>
                        <audio hidden id="audio-div" controls>
                            <source id="audio-source" src="" type="audio/wav"/>
                        </audio>
                    </center>
                </div>
                <div class="ui top attached tabular menu">
                    <a class="item active" data-tab="first">Melody Extraction</a>
                    <a class="item" data-tab="second">Key Detection</a>
                    <a class="item" data-tab="third">BPM</a>
                    <a class="item" data-tab="fourth">Loudness Meter</a>
                    <a class="item" data-tab="fifth">MFCC</a>
                </div>
                <div id="melody-div" class="ui bottom attached tab segment active" data-tab="first" style="width: 900px; height: 350px;">
                </div>
                <div id="key-div" class="ui bottom attached tab segment" data-tab="second" style="width: 900px; height: 350px;">
                </div>
                <div id="bpm-div" class="ui bottom attached tab segment" data-tab="third" style="width: 900px; height: 350px;">
                </div>
                <div id="loudness-div" class="ui bottom attached tab segment" data-tab="fourth" style="width: 900px; height: 350px;">
                </div>
                <div id="mfcc-div" class="ui bottom attached tab segment" data-tab="fifth" style="width: 900px; height: 350px;">
                </div>
            </div>

        </div>

        <center>
        <div class="footer">
            <a class="demo_logo" target="_blank" href="//essentia.upf.edu">
                <img id="logo" src="https://essentia.upf.edu/documentation/_static/essentia_logo.svg" alt="MTG Logo"
                     style="margin-left: 40px; height: 70px;">
            </a>
            <a target="_blank" href="https://www.upf.edu/web/mtg">
                <img class="essnt-footer_mtg-logo" src="https://mtg.github.io/assets/img/upflogo.png" alt="mtg logo"
                     style="width:300px; height: 70px;">
            </a>
        </div>
        </center>

    </div>

</div>   
  </body>
</html>